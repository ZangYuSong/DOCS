# HTTP、HTTP2 与 HTTPS

## 简介

* HTTP : 超文本传输协议，是一个基于请求与响应，无状态的，应用层的协议，常基于 TCP/IP 协议传输数据，互联网上应用最为广泛的一种网络协议，所有的 WWW 文件都必须遵守这个标准
* HTTP2 : HTTP 协议的的第二个主要版本，使用于万维网。HTTP/2 是 HTTP 协议自 1999 年 HTTP 1.1 发布后的首个更新，主要基于 SPDY 协议（是 Google 开发的基于 TCP 的应用层协议，用以最小化网络延迟，提升网络速度，优化用户的网络使用体验）
* HTTPS : 一种通过计算机网络进行安全通信的传输协议，经由 HTTP 进行通信，利用 SSL/TLS 建立全信道，加密数据包。HTTPS 使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性

## HTTP 特点

### HTTP 1.1

* 无状态：协议对客户端没有状态存储，对事物处理没有记忆能力，比如访问一个网站需要反复进行登录操作
* 无连接：HTTP/1.1 之前，由于无状态特点，每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。比如某个客户机在短时间多次请求同一个资源，服务器并不能区别是否已经响应过用户的请求，所以每次需要重新响应请求，需要耗费不必要的时间和流量
* 基于请求和响应：基本的特性，由客户端发起请求，服务端响应
* 简单快速、灵活
* 通信使用明文、请求和响应不会对通信方进行确认、无法保护数据的完整性

### HTTP 2

* HTTP/2 采用二进制格式而非文本格式
* HTTP/2 是完全多路复用的，而非有序并阻塞的——只需一个连接即可实现并行
* 使用报头压缩，HTTP/2 降低了开销
* HTTP/2 让服务器可以将响应**主动推送**到客户端缓存中

## HTTPS 特点

* 基于 HTTP 协议，通过 SSL 或 TLS 提供加密处理数据、验证对方身份以及数据完整性保护
* HTTP 默认端口 80，HTTPS 默认端口 443
* HTTPS 协议需要到 CA 申请证书或者自制证书

## HTTPS 通信流程

* 1、客户端向服务端发送请求获取数据，请求端口 443
* 2、服务端向客户端发送证书，证书包括了证书的颁发机构、过期时间、服务端的公钥、第三方证书认证机构 (CA) 的签名和服务端的域名信息等内容。证书可以向 CA 申请或者自制证书，区别就是自制的证书需要客户端验证通过才可以继续访问
* 3、客户端解析证书无误之后，生成一个随机值（会话密钥），并使用服务端的公钥对其进行加密
* 4、向服务端传送会话密钥，服务端通过自己的密钥解密会话密钥
* 5、服务端使用会话密钥加密数据并传送到客户端，客户端使用会话密钥解密数据

## 总结

* HTTPS 协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用
* SSL/TLS 证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行
* 证书需要购买申请，功能越强大的证书费用越高
* 证书通常需要绑定 IP，不能在同一 IP 上绑定多个域名，IPv4 资源不可能支撑这个消耗
* 使用 HTTPS 协议会使页面的加载时间延长近 50%，增加 10% 到 20% 的耗电
* HTTPS 连接缓存不如 HTTP 高效，流量成本高
* HTTPS 连接服务器端资源占用高很多，支持访客多的网站需要投入更大的成本

补充

## TCP 与 HTTP

* HTTP 属于应用层，负责定义数据，通知服务端以什么格式返回数据
* TCP 属于传输层，负责传输数据，保证数据应该怎么传输才能稳定且高效的传递与客户端何服务端之间
* HTTP 建立在 TCP 上层，HTTP 发送一个请求会与服务器建立一个 TCP 连接用于传输数据，请求完成之后会关闭 TCP 连接
* 如果每次建立一个　HTTP 就建立一个 TCP 连接，这样当请求多的时候就显得很低效。因此 Keep-Alive 被提出用来解决效率低的问题。从 HTTP/1.1 起。默认都开启了 Keep-Alive，每次完成 HTTP 请求之后不会关闭 TCP 连接
* 在 HTTP 的规范内，客户端和服务端的交互被视为 request 和 response 的传递。而在实际的 TCP 操作中，信息传递会比单纯的传递 request 和 response 要复杂。通过 TCP 建立的通讯往往需要客户端和服务端之间多次的交换信息才能完成一次 request 或 response
* TCP 的传输数据的核心是在于将数据分为若干段并将每段数据按顺序标记。标记后的顺序可以以不同的顺序被另一方接收并集成回完整的数据。客户端对每一段数据的成功接收都会做出相应，确保所有数据的完整性
  * F : FIN - 结束; 结束会话
  * S : SYN - 同步; 表示开始会话请求
  * R : RST - 复位;中断一个连接
  * P : PUSH - 推送; 数据包立即发送
  * A : ACK - 应答
  * U : URG - 紧急
  * E : ECE - 显式拥塞提醒回应
  * W : CWR - 拥塞窗口减少
* 总结：HTTP 请求不会关心数据的接受和发送，这些内容由 TCP 负责。如果 TCP 请求中发生了数据丢包的问题但是整个 HTTP 的请求没有问题，那么它同样会返回 200